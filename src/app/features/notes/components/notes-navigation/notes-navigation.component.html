<div class="notes-navigation">
  <div class="navigation-header">
    <h3>{{ projectName }}</h3>
    <div class="search-container">
      <input
        type="text"
        class="search-input"
        placeholder="Search..."
        [(ngModel)]="searchQuery"
        (ngModelChange)="onSearchChange($event)"
      />
      @if (searchQuery()) {
      <button class="clear-button" (click)="clearSearch()" title="Clear search">
        <mat-icon>close</mat-icon>
      </button>
      }
      <mat-icon class="search-icon">search</mat-icon>
    </div>
  </div>

  <div class="tree-container">
    @if (treeNodes().length === 0) {
    <div class="empty-state">
      <p>No notes found</p>
      <small>Add your notes to assets/</small>
    </div>
    } @else {
    <ul class="tree-root">
      @for (node of treeNodes(); track trackNode($index, node)) {
      <li>
        <ng-container
          *ngTemplateOutlet="treeNodeTemplate; context: { $implicit: node }"
        ></ng-container>
      </li>
      }
    </ul>
    }
  </div>
</div>

<!-- Recursive template for tree nodes -->
<ng-template #treeNodeTemplate let-node>
  @if (isFolder(node)) {
  <div class="folder-item" (click)="toggleFolder(node)">
    <mat-icon class="folder-icon">
      {{ node.expanded ? "folder_open" : "folder" }}
    </mat-icon>
    <span class="folder-name">{{ node.name }}</span>
  </div>

  @if (node.expanded) {
  <ul class="tree-children">
    @for (child of node.children; track trackNode($index, child)) {
    <li>
      <ng-container
        *ngTemplateOutlet="treeNodeTemplate; context: { $implicit: child }"
      ></ng-container>
    </li>
    }
  </ul>
  }   } @else if (isNote(node)) {
  <a
    [routerLink]="['/' + projectSlug, node.id]"
    routerLinkActive="active"
    class="note-item"
  >
    @if (node.icon) {
    <app-iconify-icon
      [icon]="node.icon"
      [size]="20"
      class="note-icon"
      [useFallback]="true"
    />
    }
    <div class="note-content">
      <span class="note-name">{{ node.title }}</span>
      @if (searchQuery() && getSearchResult(node.id)?.matchedText) {
      <small
        class="match-snippet"
        [innerHTML]="getSearchResult(node.id)?.matchedText | highlightMatch"
      ></small>
      }
    </div>
  </a>
  }
</ng-template>
